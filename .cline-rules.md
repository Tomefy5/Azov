# CLINE CODING RULES FOR AZOV

## üéØ GOLDEN RULES

1. **Type Everything** ‚Üí No `any` types, always TypeScript strict mode
2. **Error First** ‚Üí Every async function has try/catch with meaningful errors
3. **Validate Input** ‚Üí Use Zod schemas BEFORE processing any data
4. **Security** ‚Üí Never trust user input, sanitize everything, no hardcoded secrets
5. **DRY** ‚Üí Don't Repeat Yourself, extract common logic to utilities
6. **Test Critical Paths** ‚Üí Core functionality must be testable
7. **Production Ready** ‚Üí Code must be deployable immediately

---

## ‚úÖ CODE PATTERNS TO USE

### Backend Service Pattern
```
// ‚úÖ DO THIS
export class IdentityService {
  constructor(
    private prisma: PrismaClient,
    private walrus: WalrusClient,
    private logger: Logger
  ) {}

  async verifyIdentity(input: VerifyInput): Promise<Result> {
    try {
      // 1. Validate
      const validated = VerifySchema.parse(input);
      
      // 2. Process
      const result = await this.process(validated);
      
      // 3. Store
      await this.store(result);
      
      // 4. Return
      this.logger.info('Success');
      return result;
    } catch (error) {
      this.logger.error('Failed:', error);
      throw new CustomError('Verification failed');
    }
  }
}
```

### Backend Controller Pattern
```
// ‚úÖ DO THIS
export class IdentityController {
  constructor(private service: IdentityService) {}

  async upload(req: Request, res: Response): Promise<void> {
    try {
      const result = await this.service.verifyIdentity(req.body);
      res.status(200).json({ success: true, data: result });
    } catch (error) {
      if (error instanceof ValidationError) {
        res.status(400).json({ error: error.message });
      } else {
        res.status(500).json({ error: 'Internal server error' });
      }
    }
  }
}
```

### React Component Pattern
```
// ‚úÖ DO THIS
interface FormProps {
  userId: string;
  onSuccess?: (data: any) => void;
}

export const IdentityForm: React.FC<FormProps> = ({ userId, onSuccess }) => {
  const [state, setState] = useState<State>(initialState);
  const [error, setError] = useState<string | null>(null);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      const validated = FormSchema.parse(state);
      const result = await api.verify(userId, validated);
      onSuccess?.(result);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
    }
  };

  return <form onSubmit={handleSubmit}>{/* JSX */}</form>;
};
```

### Validation Pattern
```
// ‚úÖ DO THIS - Always validate with Zod
import { z } from 'zod';

const VerifySchema = z.object({
  userId: z.string().uuid(),
  document: z.instanceof(File).refine(f => f.size < 5000000),
  selfie: z.instanceof(File).refine(f => f.size < 2000000),
});

type VerifyInput = z.infer<typeof VerifySchema>;

const input = VerifySchema.parse(req.body); // Throws if invalid
```

---

## ‚ùå PATTERNS TO AVOID

### ‚ùå NO: Untyped Parameters
```
// ‚ùå WRONG
const process = (data) => { return data; };

// ‚úÖ RIGHT
const process = (data: ProcessInput): ProcessOutput => { return data; };
```

### ‚ùå NO: Missing Error Handling
```
// ‚ùå WRONG
const result = await api.call();
res.json(result);

// ‚úÖ RIGHT
try {
  const result = await api.call();
  res.json(result);
} catch (error) {
  logger.error('API call failed:', error);
  res.status(500).json({ error: 'Failed to fetch data' });
}
```

### ‚ùå NO: Hardcoded Secrets
```
// ‚ùå WRONG
const API_KEY = 'sk-123abc...';
const DB_URL = 'postgresql://user:pass@localhost/db';

// ‚úÖ RIGHT
const API_KEY = process.env.API_KEY;
const DB_URL = process.env.DATABASE_URL;
if (!API_KEY) throw new Error('API_KEY not configured');
```

### ‚ùå NO: No Input Validation
```
// ‚ùå WRONG
const user = req.body;
await db.create(user);

// ‚úÖ RIGHT
const validated = UserSchema.parse(req.body);
await db.create(validated);
```

### ‚ùå NO: Mixing Concerns
```
// ‚ùå WRONG - Service doing controller work
export class UserService {
  async getUser(req, res) {
    const user = await db.findUser();
    res.json(user);
  }
}

// ‚úÖ RIGHT - Separated concerns
// Service: business logic only
export class UserService {
  async getUser(userId: string): Promise<User> {
    return await db.findUser(userId);
  }
}

// Controller: HTTP handling
export class UserController {
  async getUser(req: Request, res: Response) {
    const user = await this.service.getUser(req.params.id);
    res.json(user);
  }
}
```

### ‚ùå NO: Console.log in Production
```
// ‚ùå WRONG
console.log('User data:', userData);

// ‚úÖ RIGHT
logger.debug('User data:', userData);
logger.info('User created successfully');
logger.error('User creation failed:', error);
```

### ‚ùå NO: Any Types
```
// ‚ùå WRONG
const data: any = await api.call();
function process(input: any): any { }

// ‚úÖ RIGHT
const data: UserData = await api.call();
function process(input: ProcessInput): ProcessOutput { }
```

---

## üîç CODE REVIEW CHECKLIST

Every piece of generated code MUST have:

- [ ] **TypeScript Types** - All functions/variables typed
- [ ] **Error Handling** - Try/catch on async operations
- [ ] **Input Validation** - Zod schema validation
- [ ] **JSDoc Comments** - Public functions documented
- [ ] **Inline Comments** - Complex logic explained
- [ ] **Security Check** - No hardcoded secrets, input sanitized
- [ ] **No Dead Code** - All code is used
- [ ] **Proper Naming** - Clear, descriptive names
- [ ] **Performance** - DB queries optimized, no N+1 queries
- [ ] **Error Messages** - Clear, actionable error messages
- [ ] **Logging** - Important operations logged
- [ ] **No Console.log** - Use logger instead

---

## üìù NAMING CONVENTIONS

### Files
- Components: `IdentityForm.tsx` (PascalCase)
- Services: `identity.service.ts` (kebab-case)
- Utils: `validators.ts` (kebab-case)
- Types: `user.ts` (kebab-case)
- Hooks: `useIdentity.ts` (camelCase with 'use' prefix)
- Tests: `identity.service.test.ts` (`.test.ts` suffix)

### Functions
- Handlers: `handleSubmit()`, `handleChange()`
- Getters: `getUser()`, `getUserById()`
- Setters: `setUser()`, `setLoading()`
- Checkers: `isValid()`, `hasPermission()`, `canAccess()`
- Transformers: `toJSON()`, `fromDTO()`

### Variables
- Booleans: `isLoading`, `hasError`, `canSubmit`
- Arrays: `users`, `items`, `records`
- Objects: `userData`, `formState`, `result`
- Constants: `MAX_RETRIES`, `API_TIMEOUT`

### Database
- Models: PascalCase: `User`, `Certificate`
- Fields: camelCase: `userId`, `walletAddress`
- Relations: `user`, `certificates` (singular/plural appropriate)

---

## üîê SECURITY CHECKLIST

When generating any code, ensure:

- [ ] **No Hardcoded Secrets** - Use environment variables
- [ ] **Input Validation** - All user input validated with Zod
- [ ] **Password Hashing** - Use bcryptjs, never store plaintext
- [ ] **JWT Verification** - Always verify tokens
- [ ] **CORS Configured** - Only allow trusted origins
- [ ] **SQL Injection Prevention** - Use Prisma (not raw queries)
- [ ] **XSS Prevention** - React auto-escapes by default
- [ ] **CSRF Protection** - Validate token in state-changing requests
- [ ] **Rate Limiting** - Implement on API endpoints
- [ ] **Sensitive Data** - Never log passwords, tokens, PII
- [ ] **HTTPS** - Enforced in production
- [ ] **Environment Isolation** - Dev/staging/prod configs separate

---

## üß™ TESTING REQUIREMENTS

For critical functions, generate tests:

```
// ‚úÖ Example test structure
describe('IdentityService', () => {
  describe('verifyIdentity', () => {
    it('should verify valid identity', async () => {
      const result = await service.verifyIdentity(validInput);
      expect(result.success).toBe(true);
    });

    it('should throw on invalid input', async () => {
      expect(() => service.verifyIdentity(invalidInput))
        .toThrow(ValidationError);
    });

    it('should handle errors gracefully', async () => {
      jest.spyOn(db, 'create').mockRejectedValue(new Error());
      expect(() => service.verifyIdentity(input))
        .toThrow(CustomError);
    });
  });
});
```

---

## üìã COMMIT MESSAGE RULES

Follow conventional commits:

```
feat: Add identity verification service
fix: Handle missing wallet address error
docs: Update API documentation
refactor: Simplify reputation calculation
test: Add tests for auth middleware
chore: Update dependencies
style: Format code with prettier
perf: Optimize database queries
```

Format: `[type]: [brief description]`

Always:
- [ ] Be descriptive (not "fix stuff")
- [ ] Reference issue if applicable
- [ ] Keep message under 50 characters
- [ ] Use imperative mood (not "Added", use "Add")

---

## üìä PERFORMANCE CHECKLIST

When generating code:

- [ ] **Database Queries** - Use indexes, avoid N+1 queries
- [ ] **Caching** - Cache frequently accessed data in Redis
- [ ] **Pagination** - Large datasets must be paginated
- [ ] **Lazy Loading** - Frontend components lazy-loaded
- [ ] **Code Splitting** - Next.js route-based splitting
- [ ] **Image Optimization** - Compressed, responsive images
- [ ] **Bundle Size** - Monitor and optimize
- [ ] **API Response** - Minimal data sent (not full objects)
- [ ] **Async Operations** - Use queues for heavy tasks
- [ ] **Memory Leaks** - Clean up subscriptions/listeners

---

## üöÄ DEPLOYMENT CHECKLIST

Before deploying:

- [ ] **Environment Variables** - All secrets configured
- [ ] **Database Migrations** - All migrations run
- [ ] **Error Logging** - Sentry/logging configured
- [ ] **Monitoring** - Uptime/performance monitoring
- [ ] **Backups** - Database backups enabled
- [ ] **SSL/TLS** - HTTPS enforced
- [ ] **CORS** - Production origins only
- [ ] **Rate Limiting** - DDoS protection active
- [ ] **Health Checks** - Endpoint for load balancer
- [ ] **Rollback Plan** - Can quickly revert

---

## üéì WHEN TO ASK QUESTIONS TO DEVELOPER

Before generating code, ask if:

1. **Architecture unclear**: "Should this be a service or utility?"
2. **Error handling**: "What should happen if the API call fails?"
3. **Async patterns**: "Should this be queued or real-time?"
4. **Data sensitivity**: "Should this data be encrypted?"
5. **Performance**: "Will this handle 1000+ concurrent users?"
6. **Integration**: "How should this integrate with Walrus?"
7. **Testing**: "What edge cases should be tested?"

---

## üéØ CLINE BEHAVIOR RULES

When using Cline to generate code:

1. **Ask clarifying questions** if requirements unclear
2. **Show architecture implications** of decisions
3. **Provide working examples** not just snippets
4. **Add comments** explaining complex logic
5. **Suggest improvements** beyond requirements
6. **Warn about edge cases** not handled
7. **Reference existing code** for consistency
8. **Mention security implications** for sensitive operations
9. **Consider performance** impact of implementations
10. **Offer alternatives** when multiple valid approaches exist

---

## üìö FILE STRUCTURE RULES

Always generate files in correct locations:

```
‚úÖ Services go in: backend/src/services/
‚úÖ Controllers go in: backend/src/controllers/
‚úÖ Routes go in: backend/src/routes/
‚úÖ Components go in: frontend/src/components/
‚úÖ Hooks go in: frontend/src/hooks/
‚úÖ Types go in: [backend|frontend]/src/types/
‚úÖ Utils go in: [backend|frontend]/src/lib/
```

---

## üîÑ CODE REVIEW PROCESS

When Cline generates code:

1. **Read the code** - Understand what it does
2. **Check types** - Are all variables typed?
3. **Check errors** - Is there error handling?
4. **Check security** - Any hardcoded secrets?
5. **Check performance** - Any obvious inefficiencies?
6. **Run tests** - Does it pass unit tests?
7. **Test manually** - Does it work as expected?
8. **Commit** - If all checks pass

---

**Last Updated**: Nov 7, 2025  
**Version**: 1.0

***

## üéØ COMMENT L'UTILISER

### 1Ô∏è‚É£ Cr√©er le fichier
```bash
cd azov-platform
# Copiez tout le contenu ci-dessus dans:
# .cline-rules.md
```

### 2Ô∏è‚É£ Cline va respecter automatiquement:
- ‚úÖ Les patterns de code
- ‚úÖ Les conventions de nommage
- ‚úÖ Les r√®gles de s√©curit√©
- ‚úÖ Les standards TypeScript
- ‚úÖ Les bonnes pratiques

### 3Ô∏è‚É£ Dans vos prompts, vous pouvez r√©f√©rencer:
```
"Follow the rules in .cline-rules.md"
"Generate code following AZOV coding standards"
"Ensure all code follows security checklist"
```

***

**C'est pr√™t!** Maintenant cr√©ez `.cline-architecture.md` üéâ